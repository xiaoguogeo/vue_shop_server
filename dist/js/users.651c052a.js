"use strict";(self["webpackChunkvue_shop"]=self["webpackChunkvue_shop"]||[]).push([[681],{3434:function(e,t,s){s.r(t),s.d(t,{default:function(){return d}});var r=function(){var e=this,t=e._self._c;return t("div",[t("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),t("el-breadcrumb-item",[e._v("用户管理")]),t("el-breadcrumb-item",[e._v("用户列表")])],1),t("el-card",[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容",clearable:""},on:{clear:e.queryUser},model:{value:e.queryInfo.query,callback:function(t){e.$set(e.queryInfo,"query",t)},expression:"queryInfo.query"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.queryUser},slot:"append"})],1)],1),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{type:"primary"},on:{click:e.addDialogVisible}},[e._v("添加用户")])],1)],1),t("el-table",{attrs:{data:e.userList,stripe:"",border:""}},[t("el-table-column",{attrs:{type:"index",label:"#"}}),t("el-table-column",{attrs:{label:"姓名",prop:"username"}}),t("el-table-column",{attrs:{label:"邮箱",prop:"email"}}),t("el-table-column",{attrs:{label:"电话",prop:"mobile"}}),t("el-table-column",{attrs:{label:"角色",prop:"role_name"}}),t("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-switch",{on:{change:function(t){return e.changeState(s.row)}},model:{value:s.row.mg_state,callback:function(t){e.$set(s.row,"mg_state",t)},expression:"row_data.row.mg_state"}})]}}])}),t("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{type:"primary",icon:"el-icon-edit",circle:"",size:"mini"},on:{click:function(t){return e.editUserInfo(s.row.id)}}}),t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"mini"},on:{click:function(t){return e.deleteUser(s.row.id)}}}),t("el-tooltip",{attrs:{effect:"dark",content:"分配角色",placement:"top",enterable:!1}},[t("el-button",{attrs:{type:"warning",icon:"el-icon-setting",circle:"",size:"mini"},on:{click:function(t){return e.assignRole(s.row)}}})],1)]}}])})],1),t("el-pagination",{attrs:{"current-page":e.queryInfo.pagenum,"page-sizes":[1,2,5,10],"page-size":e.queryInfo.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:"添加用户",visible:e.dialogVisibleForAdd,"close-on-click-modal":!1,width:"30%",center:""},on:{"update:visible":function(t){e.dialogVisibleForAdd=t}}},[t("el-form",{ref:"addFormRef",attrs:{model:e.addUserForm,rules:e.addOrEditFormRules,"label-width":"65px"}},[t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{model:{value:e.addUserForm.username,callback:function(t){e.$set(e.addUserForm,"username",t)},expression:"addUserForm.username"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{model:{value:e.addUserForm.password,callback:function(t){e.$set(e.addUserForm,"password",t)},expression:"addUserForm.password"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{model:{value:e.addUserForm.email,callback:function(t){e.$set(e.addUserForm,"email",t)},expression:"addUserForm.email"}})],1),t("el-form-item",{attrs:{label:"手机",prop:"mobile"}},[t("el-input",{model:{value:e.addUserForm.mobile,callback:function(t){e.$set(e.addUserForm,"mobile",t)},expression:"addUserForm.mobile"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelAddUser}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmAddUser}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"修改用户信息",visible:e.dialogVisibleForEdit,width:"30%","close-on-click-modal":!1,center:""},on:{"update:visible":function(t){e.dialogVisibleForEdit=t}}},[t("el-form",{ref:"editFormRef",attrs:{model:e.editForm,rules:e.addOrEditFormRules,"label-width":"65px"}},[t("el-form-item",{attrs:{label:"用户名",prop:"edit_username"}},[t("el-input",{attrs:{disabled:""},model:{value:e.editForm.username,callback:function(t){e.$set(e.editForm,"username",t)},expression:"editForm.username"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{model:{value:e.editForm.email,callback:function(t){e.$set(e.editForm,"email",t)},expression:"editForm.email"}})],1),t("el-form-item",{attrs:{label:"手机",prop:"mobile"}},[t("el-input",{model:{value:e.editForm.mobile,callback:function(t){e.$set(e.editForm,"mobile",t)},expression:"editForm.mobile"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelEditUser}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmEditUser}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"分配角色",visible:e.dialogVisibleForAssign,width:"30%","close-on-click-modal":!1,center:""},on:{"update:visible":function(t){e.dialogVisibleForAssign=t},close:e.assignRightsDialogClosed}},[t("p",[e._v("当前用户："+e._s(e.userInfo.username))]),t("p",[e._v("当前角色："+e._s(e.userInfo.role_name))]),t("p",[e._v(" 分配新角色： "),t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.selectedRoleId,callback:function(t){e.selectedRoleId=t},expression:"selectedRoleId"}},e._l(e.roleList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.roleName,value:e.id}})})),1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisibleForAssign=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmAssignRole}},[e._v("确 定")])],1)])],1)},i=[],a={name:"User",created(){this.getUserList()},data(){let e=(e,t,s)=>{const r=/^[a-zA-Z0-9_-]+@([a-zA-Z0-9_-]+\.)+(com|cn|com\.cn)/;r.test(t)&&s(),s(new Error("请输入正确的邮箱"))},t=(e,t,s)=>{const r=/^(13[0-9]|15[0-9]|17[0-9]|18[0-9]|14[57])[0-9]{8}$/;r.test(t)&&s(),s(new Error("请输入正确的手机号"))};return{queryInfo:{query:"",pagenum:1,pagesize:2},userList:[],addUserForm:{username:"",password:"",email:"",mobile:""},editForm:{},addOrEditFormRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:18,message:"用户名长度为3~18",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:3,max:18,message:"密码长度为3~18",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:e,trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号码",trigger:"blur"},{validator:t,trigger:"blur"}],edit_username:[]},total:0,userInfo:{},roleList:[],selectedRoleId:"",dialogVisibleForAdd:!1,dialogVisibleForEdit:!1,dialogVisibleForAssign:!1}},methods:{async getUserList(){const{data:e}=await this.$http.get("users",{params:this.queryInfo});if(200!==e.meta.status)return this.$message({message:"获取用户列表失败",type:"error",center:!0});this.userList=e.data.users,this.total=e.data.total},handleSizeChange(e){this.queryInfo.pagesize=e,this.getUserList()},handleCurrentChange(e){this.queryInfo.pagenum=e,this.getUserList()},queryUser(){this.getUserList()},addDialogVisible(){this.dialogVisibleForAdd=!0},async changeState(e){const{data:t}=await this.$http.put(`users/${e.id}/state/${e.mg_state}`);if(200!==t.meta.status)return e.mg_state=!e.mg_state,this.$message({message:"状态修改失败",type:"error",center:!0})},confirmAddUser(){this.$refs.addFormRef.validate((async e=>{if(!e)return;this.dialogVisibleForAdd=!1;const{data:t}=await this.$http.post("users",this.addUserForm);if(201!==t.meta.status)return this.$message({message:"添加用户失败",type:"error",center:!0});this.$message({message:t.meta.msg,type:"success",center:!0}),this.getUserList(),this.$refs.addFormRef.resetFields()}))},cancelAddUser(){this.dialogVisibleForAdd=!1,this.$refs.addFormRef.resetFields()},async editUserInfo(e){const{data:t}=await this.$http.get(`users/${e}`);if(200!==t.meta.status)return this.$message({message:"修改用户信息失败",type:"error",center:!0});this.dialogVisibleForEdit=!0,this.editForm=t.data},confirmEditUser(){this.$refs.editFormRef.validate((async e=>{if(!e)return;const{data:t}=await this.$http.put(`users/${this.editForm.id}`,{email:this.editForm.email,mobile:this.editForm.mobile});if(200!==t.meta.status)return this.$message({message:"更新用户信息失败",type:"error",center:!0});this.dialogVisibleForEdit=!1,this.$message({message:"更新用户信息成功",type:"success",center:!0}),this.getUserList()}))},cancelEditUser(){this.dialogVisibleForEdit=!1,this.$refs.editFormRef.resetFields()},async deleteUser(e){const t=await this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((e=>e));if("confirm"!==t)return this.$message({message:"已取消删除",type:"info",center:!0});{const{data:t}=await this.$http.delete(`users/${e}`);if(200!==t.meta.status)return this.$message({message:"删除失败",type:"error",center:!0});this.$message({message:"删除成功",type:"success",center:!0}),this.getUserList()}},async assignRole(e){this.userInfo=e,this.dialogVisibleForAssign=!0;const{data:t}=await this.$http.get("roles");if(200!==t.meta.status)return this.$message({message:"获取角色列表失败",type:"error",center:!0});this.roleList=t.data},async confirmAssignRole(){if(!this.selectedRoleId)return this.$message({message:"请选择要分配的新角色",type:"error",center:!0});const{data:e}=await this.$http.put(`users/${this.userInfo.id}/role`,{rid:this.selectedRoleId});if(200!==e.meta.status)return this.$message({message:"分配角色失败",type:"error",center:!0});this.$message({message:"分配角色成功",type:"success",center:!0}),this.getUserList(),this.dialogVisibleForAssign=!1},assignRightsDialogClosed(){this.selectedRoleId="",this.userInfo={}}}},o=a,l=s(1001),n=(0,l.Z)(o,r,i,!1,null,"ed7c7b5a",null),d=n.exports}}]);
//# sourceMappingURL=users.651c052a.js.map