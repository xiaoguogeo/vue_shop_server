"use strict";(self["webpackChunkvue_shop"]=self["webpackChunkvue_shop"]||[]).push([[852],{3605:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});var l=function(){var e=this,t=e._self._c;return t("div",[t("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v(" 首页 ")]),t("el-breadcrumb-item",[e._v("权限管理")]),t("el-breadcrumb-item",[e._v("权限列表")])],1),t("el-card",[t("el-table",{attrs:{data:e.rightsList,border:"",stripe:""}},[t("el-table-column",{attrs:{type:"index",label:"#"}}),t("el-table-column",{attrs:{label:"权限名称",prop:"authName"}}),t("el-table-column",{attrs:{label:"路径",prop:"path"}}),t("el-table-column",{attrs:{label:"权限等级"},scopedSlots:e._u([{key:"default",fn:function(s){return["0"===s.row.level?t("el-tag",[e._v("一级")]):e._e(),"1"===s.row.level?t("el-tag",{attrs:{type:"success"}},[e._v("二级")]):e._e(),"2"===s.row.level?t("el-tag",{attrs:{type:"warning"}},[e._v("三级")]):e._e()]}}])})],1)],1)],1)},i=[],r={name:"Right",created(){this.getRightList()},data(){return{rightsList:[]}},methods:{async getRightList(){const{data:e}=await this.$http.get("rights/list");if(200!==e.meta.status)return this.$message({message:"获取用户权限失败",type:"error",center:!0});this.rightsList=e.data}}},o=r,a=s(1001),n=(0,a.Z)(o,l,i,!1,null,"640ca207",null),c=n.exports},5584:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});var l=function(){var e=this,t=e._self._c;return t("div",[t("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),t("el-breadcrumb-item",[e._v("权限管理")]),t("el-breadcrumb-item",[e._v("角色列表")])],1),t("el-card",[t("el-row",[t("el-col",{staticStyle:{"text-align":"left"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.showAddRoleDialog}},[e._v("添加角色")])],1),t("el-col",[t("el-table",{attrs:{data:e.roleList,border:"",stripe:""}},[t("el-table-column",{attrs:{type:"expand",width:"50px"},scopedSlots:e._u([{key:"default",fn:function(s){return e._l(s.row.children,(function(l,i){return t("el-row",{key:l.id,class:["bottom-line",0===i?"top-line":""],attrs:{type:"flex",align:"middle"}},[t("el-col",{attrs:{span:5}},[t("el-tag",{attrs:{closable:""},on:{close:function(t){return e.removeRightById(s.row,l.id)}}},[e._v(e._s(l.authName))]),t("i",{staticClass:"el-icon-caret-right"})],1),t("el-col",{attrs:{span:19}},e._l(l.children,(function(l,i){return t("el-row",{key:l.id,class:[0===i?"":"top-line"],attrs:{type:"flex",align:"middle"}},[t("el-col",{attrs:{span:6}},[t("el-tag",{attrs:{type:"success",closable:""},on:{close:function(t){return e.removeRightById(s.row,l.id)}}},[e._v(" "+e._s(l.authName)+" ")]),t("i",{staticClass:"el-icon-caret-right"})],1),t("el-col",{attrs:{span:18}},e._l(l.children,(function(l){return t("el-tag",{key:l.id,attrs:{type:"warning",closable:""},on:{close:function(t){return e.removeRightById(s.row,l.id)}}},[e._v(" "+e._s(l.authName)+" ")])})),1)],1)})),1)],1)}))}}])}),t("el-table-column",{attrs:{label:"#",type:"index",align:"center"}}),t("el-table-column",{attrs:{label:"角色名称",prop:"roleName"}}),t("el-table-column",{attrs:{label:"角色权限",prop:"roleDesc"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"300px"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(t){return e.showEditRoleInfoDialog(s.row.id)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(t){return e.deleteRoleById(s.row.id)}}},[e._v("删除")]),t("el-tooltip",{attrs:{effect:"dark",content:"分配权限",placement:"top",enterable:!1}},[t("el-button",{attrs:{type:"warning",icon:"el-icon-setting",size:"mini"},on:{click:function(t){return e.showSetRightDialog(s.row)}}},[e._v("分配权限")])],1)]}}])})],1)],1)],1)],1),t("el-dialog",{attrs:{title:"添加角色",visible:e.addRoleDialogVisible,width:"30%","before-close":e.handleClose,"close-on-click-modal":!1,center:""},on:{"update:visible":function(t){e.addRoleDialogVisible=t}}},[t("el-form",{ref:"addRoleRef",attrs:{model:e.addRoleForm,rules:e.addOrEditRoleRules,"label-width":"85px"}},[t("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[t("el-input",{model:{value:e.addRoleForm.roleName,callback:function(t){e.$set(e.addRoleForm,"roleName",t)},expression:"addRoleForm.roleName"}})],1),t("el-form-item",{attrs:{label:"角色描述",prop:"roleDesc"}},[t("el-input",{model:{value:e.addRoleForm.roleDesc,callback:function(t){e.$set(e.addRoleForm,"roleDesc",t)},expression:"addRoleForm.roleDesc"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelAddRole}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmAddRole}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"编辑角色",visible:e.editRoleDialogVisible,width:"30%","before-close":e.handleClose,"close-on-click-modal":!1,center:""},on:{"update:visible":function(t){e.editRoleDialogVisible=t}}},[t("el-form",{ref:"editRoleRef",attrs:{model:e.editRoleForm,rules:e.addOrEditRoleRules,"label-width":"85px"}},[t("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[t("el-input",{model:{value:e.editRoleForm.roleName,callback:function(t){e.$set(e.editRoleForm,"roleName",t)},expression:"editRoleForm.roleName"}})],1),t("el-form-item",{attrs:{label:"角色描述",prop:"roleDesc"}},[t("el-input",{model:{value:e.editRoleForm.roleDesc,callback:function(t){e.$set(e.editRoleForm,"roleDesc",t)},expression:"editRoleForm.roleDesc"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelEditRole}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmEditRole}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"分配权限",visible:e.setRightDialogVisible,width:"40%","close-on-click-modal":!1,center:""},on:{"update:visible":function(t){e.setRightDialogVisible=t}}},[t("el-tree",{ref:"rightRef",attrs:{data:e.rightTree,props:e.rightTreeProps,"show-checkbox":"","default-expand-all":"","node-key":"id","default-checked-keys":e.leafArr}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.setRightDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.assignRights}},[e._v("确 定")])],1)],1)],1)},i=[],r=(s(7658),{name:"Roles",created(){this.getRoleList()},data(){return{roleList:[],setRightDialogVisible:!1,addRoleDialogVisible:!1,editRoleDialogVisible:!1,addRoleForm:{roleName:"",roleDesc:""},currentEditRoleId:"",editRoleForm:{},addOrEditRoleRules:{roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleDesc:[{required:!0,message:"角色描述不能为空",trigger:"blur"}]},rightTree:[],rightTreeProps:{label:"authName",children:"children"},leafArr:[],roleId:""}},methods:{async getRoleList(){const{data:e}=await this.$http.get("roles");if(200!==e.meta.status)return this.message.error("获取角色列表失败");this.roleList=e.data},async removeRightById(e,t){const s=await this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).catch((e=>e));if("confirm"!==s)return this.$message({message:"已取消删除",type:"info",center:!0});{const{data:s}=await this.$http.delete(`roles/${e.id}/rights/${t}`);if(200!==s.meta.status)return this.$message({message:"删除权限失败",type:"error",center:!0});e.children=s.data,this.$message({message:"删除权限成功",type:"success",center:!0})}},async showSetRightDialog(e){this.roleId=e.id;const{data:t}=await this.$http.get("rights/tree");this.rightTree=t.data,this.leafArr=[],this.getLeafsId(e,this.leafArr),this.setRightDialogVisible=!0},getLeafsId(e,t){if(!e.children)return t.push(e.id);e.children.forEach((e=>{this.getLeafsId(e,t)}))},async assignRights(){const e=[...this.$refs.rightRef.getCheckedKeys(),...this.$refs.rightRef.getHalfCheckedKeys()];let t=e.join(",");const{data:s}=await this.$http.post(`roles/${this.roleId}/rights`,{rids:t});if(200!==s.meta.status)return this.$message({message:"分配权限失败",type:"error",center:!0});this.setRightDialogVisible=!1,this.$message({message:"分配权限成功",type:"success",center:!0}),this.getRoleList()},showAddRoleDialog(){this.addRoleDialogVisible=!0},confirmAddRole(){this.$refs.addRoleRef.validate((async e=>{if(!e)return;const{data:t}=await this.$http.post("roles",this.addRoleForm);if(201!==t.meta.status)return this.$message({message:"添加角色失败",type:"error",center:!0});this.$message({message:"添加角色成功",type:"success",center:!0}),this.addRoleDialogVisible=!1,this.getRoleList(),this.$refs.addRoleRef.resetFields()}))},cancelAddRole(){this.addRoleDialogVisible=!1,this.$refs.addRoleRef.resetFields()},handleClose(){this.$confirm("确认关闭？").then((e=>{"confirm"===e&&(this.addRoleDialogVisible=!1,this.editRoleDialogVisible=!1,this.$refs.addRoleRef.resetFields(),this.$refs.editRoleRef.resetFields())})).catch((e=>{}))},async showEditRoleInfoDialog(e){const{data:t}=await this.$http.get(`roles/${e}`);if(200!==t.meta.status)return this.$message({message:"获取角色信息失败",type:"error",center:!0});this.editRoleDialogVisible=!0,this.editRoleForm=t.data,this.currentEditRoleId=e},confirmEditRole(){this.$refs.editRoleRef.validate((async e=>{if(!e)return;const{data:t}=await this.$http.put(`roles/${this.currentEditRoleId}`,this.editRoleForm);if(200!==t.meta.status)return this.$message({message:"修改角色信息失败",type:"error",center:!0});this.$message({message:"修改角色信息成功",type:"success",center:!0}),this.editRoleDialogVisible=!1,this.getRoleList(),this.$refs.editRoleRef.resetFields()}))},cancelEditRole(){this.editRoleDialogVisible=!1,this.$refs.editRoleRef.resetFields()},async deleteRoleById(e){const t=await this.$confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).catch((e=>e));if("confirm"!==t)return this.$message({message:"已取消删除",type:"info",center:!0});{const{data:t}=await this.$http.delete(`roles/${e}`);if(200!==t.meta.status)return this.$message({message:"删除角色失败",type:"error",center:!0});this.$message({message:"删除角色成功",type:"success",center:!0}),this.getRoleList()}}}}),o=r,a=s(1001),n=(0,a.Z)(o,l,i,!1,null,"4a9c4e17",null),c=n.exports}}]);
//# sourceMappingURL=rights_roles.c347d220.js.map